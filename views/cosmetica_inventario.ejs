<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventario Cosmético</title>

  <!-- Libs CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>

  <!-- Tus estilos -->
  <link rel="stylesheet" href="/css/inventario_cosmetica.css"/>
</head>

<body>
  <!-- Header -->
  <div class="app-header d-flex align-items-center justify-content-between px-4 py-3">
    <div class="d-flex align-items-center">
      <span class="header-title">
        Inventario de Insumos de Cosmética RAM <span id="ram-number">--</span>
      </span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <img id="user-avatar" src="/img/usuario.webp" alt="Usuario" class="user-icon">
      <span class="username ms-2" id="username">Usuario</span>
      <button id="logout-icon" class="btn btn-link p-0 ms-3 logout-btn" title="Cerrar sesión" aria-label="Cerrar sesión">
        <i class="fas fa-right-from-bracket"></i>
      </button>
    </div>
  </div>

  <div class="admin-container">
    <!-- Loading state -->
    <div id="loading-state" class="text-center loading-spinner">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando inventario...</p>
    </div>

    <!-- Error state -->
    <div id="error-state" class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i>
      <span id="error-message">Ha ocurrido un error al cargar los datos.</span>
      <button class="btn btn-outline-danger btn-sm ms-2" id="retry-btn">
        <i class="fas fa-refresh"></i> Reintentar
      </button>
    </div>

    <!-- Tabs de navegación -->
    <ul class="nav nav-tabs" id="inventarioTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="inventario-tab" data-bs-toggle="tab" 
                data-bs-target="#inventario" type="button" role="tab" 
                aria-controls="inventario" aria-selected="true">
          <i class="fas fa-boxes"></i> Inventario
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link position-relative" id="transferencias-tab" data-bs-toggle="tab" 
                data-bs-target="#transferencias" type="button" role="tab" 
                aria-controls="transferencias" aria-selected="false">
          <i class="fas fa-exchange-alt"></i> Transferencias
          <span id="badge-transferencias" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none">0</span>
        </button>
      </li>
    </ul>

    <!-- Contenido de las tabs -->
    <div class="tab-content" id="inventarioTabsContent">
      <!-- Tab de Inventario -->
      <div class="tab-pane fade show active" id="inventario" role="tabpanel" aria-labelledby="inventario-tab">
        <div class="mt-4">
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> 
            Use "Envío" para agregar stock (entrada). Use "Recibo" para quitar stock (salida).
            Use "Pendientes" para ver transferencias entre RAMs.
          </div>
          
          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" id="inventario-table">
                  <thead class="table-dark">
                    <tr>
                      <th scope="col">Nombre SKU</th>
                      <th scope="col">Capuchones</th>
                      <th scope="col">Bases</th>
                      <th scope="col">Tapas</th>
                      <th scope="col">Total General</th>
                      <th scope="col">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="inventario-tbody">
                    <tr>
                      <td colspan="6" class="text-center">Cargando datos...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab de Transferencias -->
      <div class="tab-pane fade" id="transferencias" role="tabpanel" aria-labelledby="transferencias-tab">
        <div class="mt-4">
          <div class="row">
            <!-- Transferencias por Recibir -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0"><i class="fas fa-inbox"></i> Por Recibir</h5>
                </div>
                <div class="card-body" id="transferencias-recibo">
                  <div class="text-center text-muted">
                    <div class="spinner-border spinner-border-sm" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2">Cargando transferencias...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Transferencias Enviadas -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header bg-warning text-dark">
                  <h5 class="mb-0"><i class="fas fa-clock"></i> Enviadas (Pendientes)</h5>
                </div>
                <div class="card-body" id="transferencias-enviadas">
                  <div class="text-center text-muted">
                    <div class="spinner-border spinner-border-sm" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2">Cargando transferencias...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /tab-content -->
  </div><!-- /admin-container -->

  <!-- SISTEMA DE TICKETS -->
  <button class="tickets-trigger" id="open-tickets-btn">
    <i class="fas fa-ticket-alt"></i>
    <span>Tickets</span>
  </button>

  <div class="tickets-overlay" id="tickets-overlay"></div>

  <div class="tickets-panel" id="tickets-panel">
    <div class="tickets-header">
      <h3>Sistema de Tickets</h3>
      <button class="close-tickets-btn" id="close-tickets-btn">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="tickets-content">
      <div class="tickets-tabs">
        <button class="tickets-tab active" data-tab="create">
          <i class="fas fa-plus-circle"></i> Crear Ticket
        </button>
        <button class="tickets-tab" data-tab="view">
          <i class="fas fa-list"></i> Mis Tickets
        </button>
      </div>

      <!-- Crear Ticket -->
      <div id="create-ticket-tab" class="tab-content">
        <form class="ticket-form" id="ticket-form">
          <div class="form-group">
            <label for="ticket-type">Tipo de Solicitud</label>
            <select id="ticket-type" name="tipo" required>
              <option value="">Seleccionar tipo...</option>
              <option value="SOLICITUD_FUNCION">Solicitud de Función</option>
              <option value="REPORTAR_PROBLEMA">Reportar Problema</option>
            </select>
          </div>

          <div class="form-group">
            <label for="ticket-user">Usuario Solicitante</label>
            <input type="text" id="ticket-user" name="usuario" readonly class="readonly-input">
          </div>

          <div class="form-group">
            <label for="ticket-description">Descripción</label>
            <textarea id="ticket-description" name="descripcion" placeholder="Describe detalladamente el problema o solicitud..." required></textarea>
          </div>

          <div class="form-group">
            <label>Nivel de Prioridad</label>
            <div class="priority-selector">
              <div class="priority-option priority-1" data-priority="1">
                <div class="priority-number">1</div>
                <div class="priority-label">Baja</div>
              </div>
              <div class="priority-option priority-2" data-priority="2">
                <div class="priority-number">2</div>
                <div class="priority-label">Media Baja</div>
              </div>
              <div class="priority-option priority-3" data-priority="3">
                <div class="priority-number">3</div>
                <div class="priority-label">Media</div>
              </div>
              <div class="priority-option priority-4" data-priority="4">
                <div class="priority-number">4</div>
                <div class="priority-label">Alta</div>
              </div>
              <div class="priority-option priority-5" data-priority="5">
                <div class="priority-number">5</div>
                <div class="priority-label">Crítica</div>
              </div>
            </div>
          </div>

          <button type="submit" class="submit-ticket-btn">
            <i class="fas fa-paper-plane"></i>
            Enviar Ticket
          </button>
        </form>
      </div>

      <!-- Ver Tickets -->
      <div id="view-tickets-tab" class="tab-content d-none">
        <div class="tickets-list" id="tickets-list"></div>
      </div>
    </div>
  </div>

  <!-- Modales -->
  <div class="modal fade" id="movimientoModal" tabindex="-1" aria-labelledby="movimientoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" id="movimientoModalHeader">
          <h5 class="modal-title" id="movimientoModalTitle">Registrar Movimiento</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <form id="movimientoForm" novalidate>
            <input type="hidden" id="movimientoSkuId" name="skuId"/>
            <input type="hidden" id="tipoMovimiento" name="tipoMovimiento"/>
            <div class="mb-3">
              <label class="form-label">SKU:</label>
              <p class="form-control-plaintext fw-bold mb-2" id="movimientoNombreSkuModal">-</p>
            </div>
            <div class="mb-3">
              <label for="movimientoTipoInsumo" class="form-label">Insumo <span class="text-danger">*</span></label>
              <select class="form-select" id="movimientoTipoInsumo" name="tipoInsumo" required>
                <option value="">Seleccione un insumo</option>
                <option value="CAPUCHONES">Capuchones</option>
                <option value="BASES">Bases</option>
                <option value="TAPAS">Tapas</option>
              </select>
              <div class="invalid-feedback">Debe seleccionar un tipo de insumo.</div>
            </div>
            <div class="mb-3">
              <label for="movimientoCantidad" class="form-label">Cantidad <span class="text-danger">*</span></label>
              <input type="number" class="form-control" id="movimientoCantidad" name="cantidad" min="1" required/>
              <div class="invalid-feedback">Debe ingresar una cantidad válida.</div>
              <div class="form-text" id="movimientoInfo">
                Disponible para recibo: <span id="movimiento-cantidad-disponible">--</span>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" form="movimientoForm" class="btn btn-primary" id="btn-movimiento">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Guardar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="envioModal" tabindex="-1" aria-labelledby="envioModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="envioModalLabel">Registrar Envío de Insumos</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <form id="envioForm" novalidate>
            <input type="hidden" id="envioSkuId" name="skuId"/>
            <div class="mb-3">
              <label class="form-label">SKU:</label>
              <p class="form-control-plaintext fw-bold mb-2" id="envioNombreSkuModal">-</p>
            </div>
            <div class="mb-3">
              <label for="envioTipoInsumo" class="form-label">Insumo <span class="text-danger">*</span></label>
              <select class="form-select" id="envioTipoInsumo" name="tipoInsumo" required>
                <option value="">Seleccione un insumo</option>
                <option value="CAPUCHONES">Capuchones</option>
                <option value="BASES">Bases</option>
                <option value="TAPAS">Tapas</option>
              </select>
              <div class="invalid-feedback">Debe seleccionar un tipo de insumo.</div>
            </div>
            <div class="mb-3">
              <label for="envioCantidad" class="form-label">Cantidad <span class="text-danger">*</span></label>
              <input type="number" class="form-control" id="envioCantidad" name="cantidad" min="1" required/>
              <div class="invalid-feedback">Debe ingresar una cantidad válida.</div>
              <div class="form-text">Disponible: <span id="envio-cantidad-disponible">--</span></div>
            </div>
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i> El envío será descontado de su inventario y estará pendiente hasta que el destinatario confirme el recibo.
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" form="envioForm" class="btn btn-primary" id="btn-enviar">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Enviar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Libs JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Tu JS -->
  <script src="/js/cosmetica_inventario.js"></script>
</body>
</html>
